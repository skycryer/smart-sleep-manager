<!DOCTYPE html>
<html>
<head>
    <title>Smart Sleep Manager - Local Test</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>üåô Smart Sleep Manager - Local Test</h1>
    
    <h2>üì± Telegram Test</h2>
    <form>
        <p>
            <label>Bot Token:</label><br>
            <input type="text" name="telegram_bot_token" value="8360757642:AAFG4o9hur1i-gx6xr4TIsTeMl_HKds4N5Q" style="width: 400px;">
        </p>
        <p>
            <label>Chat ID:</label><br>
            <input type="text" name="telegram_chat_id" value="156508724" style="width: 200px;">
        </p>
        
        <p>
            <input type="button" value="Test PHP" onclick="testPHP()">
            <input type="button" value="Test Telegram" onclick="testTelegram(this.form)">
        </p>
    </form>

    <h2>üìã Debug Output</h2>
    <div id="debug" style="background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; font-family: monospace;"></div>

<script>
function log(message) {
    const debug = document.getElementById('debug');
    debug.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
}

function testPHP() {
    log('Testing PHP...');
    
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '/include/test_basic.php', true);
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            log('PHP Test Status: ' + xhr.status);
            log('PHP Test Response: ' + xhr.responseText);
            
            if (xhr.status === 200) {
                try {
                    var response = JSON.parse(xhr.responseText);
                    alert('‚úÖ PHP Test successful!\nPHP Version: ' + response.php_version + '\nTime: ' + response.timestamp);
                    log('‚úÖ PHP Test successful!');
                } catch (e) {
                    alert('‚ùå PHP Test failed: Invalid JSON\n\nResponse: ' + xhr.responseText.substring(0, 200));
                    log('‚ùå JSON parse error: ' + e.message);
                }
            } else {
                alert('‚ùå PHP Test failed: HTTP ' + xhr.status);
                log('‚ùå HTTP error: ' + xhr.status);
            }
        }
    };
    xhr.send();
}

function testTelegram(form) {
    if (!form.telegram_bot_token.value || !form.telegram_chat_id.value) {
        alert('Please enter both Bot Token and Chat ID to test Telegram');
        return;
    }
    
    log('Testing Telegram...');
    
    // Show loading message
    var button = document.querySelector('input[value="Test Telegram"]');
    var originalValue = button.value;
    button.value = 'Sending...';
    button.disabled = true;
    
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/include/test_telegram.php', true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
            // Reset button
            button.value = originalValue;
            button.disabled = false;
            
            log('Telegram Test Status: ' + xhr.status);
            log('Telegram Test Response: ' + xhr.responseText);
            
            if (xhr.status === 200) {
                try {
                    var response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        alert('‚úÖ Telegram test successful! Message sent.');
                        log('‚úÖ Telegram test successful!');
                    } else {
                        alert('‚ùå Telegram test failed: ' + response.error);
                        log('‚ùå Telegram test failed: ' + response.error);
                    }
                } catch (e) {
                    console.error('JSON parse error:', e);
                    console.error('Response text:', xhr.responseText);
                    alert('‚ùå Telegram test failed: Invalid response from server\n\nResponse: ' + xhr.responseText.substring(0, 200));
                    log('‚ùå JSON parse error: ' + e.message);
                }
            } else {
                alert('‚ùå Network error during Telegram test (HTTP ' + xhr.status + ')');
                log('‚ùå Network error: HTTP ' + xhr.status);
            }
        }
    };
    xhr.send('bot_token=' + encodeURIComponent(form.telegram_bot_token.value) + 
             '&chat_id=' + encodeURIComponent(form.telegram_chat_id.value));
}
</script>

</body>
</html>